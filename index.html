<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farcaster En Çok Etkileşime Girenler (Web3)</title>
    <!-- Tailwind CSS Yüklemesi -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Ethers.js Yüklemesi (Web3 İşlemleri İçin) -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <!-- Inter Font Yüklemesi -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght100..900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Hafif arka plan */
        }
        /* Farcaster'a benzer Mor renk paleti */
        .primary-bg {
            background-color: #793FEF;
        }
        .primary-text {
            color: #793FEF;
        }
        .transaction-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-lg bg-white shadow-xl rounded-2xl p-6 md:p-8">
        <!-- Başlık Bölümü -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-extrabold text-gray-900 flex items-center justify-center">
                <svg class="w-8 h-8 mr-2 primary-text" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm-1 16v-4h2v4h-2zm-1-6V6h2v6h-2z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Farcaster Etkileşim Analizcisi
            </h1>
            <p class="text-sm text-gray-500 mt-1">Gerçek Web3 Bağlantısı ve NFT Basımı (Base Mainnet)</p>
        </header>

        <!-- Cüzdan Bağlantı Alanı -->
        <div id="wallet-section" class="mb-6 p-4 border border-indigo-200 bg-indigo-50 rounded-xl">
            <div id="wallet-status" class="flex items-center justify-between text-sm font-medium">
                <span id="wallet-label" class="text-gray-700">Ağ: <span id="network-info" class="font-bold text-red-500">Yükleniyor...</span></span>
                <span id="wallet-label" class="text-gray-700">Cüzdan: <span id="wallet-info" class="font-bold text-red-500">Bağlı Değil</span></span>
                <button id="connect-wallet-button" class="flex items-center primary-bg text-white font-semibold py-2 px-4 rounded-lg hover:opacity-90 transition duration-150 shadow-md" onclick="connectWallet()">
                    <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0l-1 1a2 2 0 00-2 2h10a2 2 0 002-2v-2"></path></svg>
                    Cüzdanı Bağla (MetaMask)
                </button>
            </div>
            <p id="tx-info" class="text-xs mt-2 text-center text-red-600 hidden">Lütfen MetaMask işlemini onaylayın...</p>
        </div>

        <!-- Kullanıcı Giriş Formu -->
        <div id="input-section" class="mb-6">
            <label for="fname" class="block text-sm font-medium text-gray-700 mb-2">
                Farcaster Kullanıcı Adınızı (fname) Girin:
            </label>
            <div class="flex space-x-2">
                <input type="text" id="fname" placeholder="örn: dwr" class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                <button id="analyze-button" class="bg-gray-400 text-white font-semibold py-3 px-5 rounded-lg transition duration-150 shadow-md flex items-center justify-center cursor-not-allowed transaction-button" onclick="analyzeEngagers()" disabled>
                    <svg id="button-icon" class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Analiz Et
                </button>
            </div>
            <p id="error-message" class="text-red-500 text-sm mt-2 hidden"></p>
        </div>

        <!-- Sonuç Alanı -->
        <div id="results-section" class="hidden">
            <h2 class="text-xl font-bold primary-text mb-4 border-b border-gray-200 pb-2">
                <span id="target-fname" class="font-mono bg-indigo-100 px-2 py-0.5 rounded text-base"></span>
                için En Çok Etkileşime Girenler (API Simülasyonu)
            </h2>
            <ul id="engager-list" class="space-y-3 mb-6">
                <!-- Etkileşimciler buraya eklenecek -->
            </ul>

            <!-- NFT Basma ve Cast Etme Butonu -->
            <button id="mint-cast-button" class="w-full primary-bg text-white font-semibold py-3 rounded-lg hover:opacity-90 transition duration-150 shadow-lg flex items-center justify-center transaction-button" onclick="mintAndCast()">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                NFT Bas ve Farcaster'a Yayınla!
            </button>
            <p id="counter-display" class="mt-4 text-sm text-center text-gray-600">Sayaç Durumu: Yükleniyor...</p>
        </div>

        <!-- Yükleniyor Göstergesi -->
        <div id="loading-indicator" class="hidden flex justify-center items-center p-8">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 primary-text border-t-2 border-indigo-500"></div>
            <p class="ml-3 text-gray-600">İşlem yapılıyor, lütfen MetaMask'i kontrol edin...</p>
        </div>
    </div>

    <script>
        // GERÇEK PINATA API ANAHTARI (Sadece Farcaster veri simülasyonu için kullanılır)
        const API_ENDPOINT = "https://topengagers.vercel.app/"; 
        
        // --- BASE MAINNET AYARLARI ---
        const TARGET_CHAIN_ID_DEC = 8453;
        const TARGET_CHAIN_ID_HEX = '0x2105'; // Base Mainnet Chain ID (Hex)
        const TARGET_NETWORK_NAME = 'Base';

        // --- ÖNEMLİ DEĞİŞİKLİK ---
        // BU KONTRAT ADRESİNİ, SİZİN BASE MAINNET ÜZERİNDE DEPLOY ETTİĞİNİZ
        // KENDİ AKILLI KONTRATINIZIN ADRESİ İLE DEĞİŞTİRMENİZ GEREKİR.
        const CONTRACT_ADDRESS = "0xSIIN_BASE_MAINNET_KONTRAT_ADRESINIZ"; // <-- BURAYI GÜNCELLEYİN!
        // --- ÖNEMLİ DEĞİŞİKLİK ---

        // ABI'nızın, deploy ettiğiniz kontrat ile eşleştiğinden emin olun
        const CONTRACT_ABI = [
            // incrementCounter fonksiyonu
            { "inputs": [], "name": "incrementCounter", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
            // mintMemorialNFT fonksiyonu (ERC-721 mint simülasyonu)
            { "inputs": [ { "internalType": "address", "name": "to", "type": "address" }, { "internalType": "uint256", "name": "tokenId", "type": "uint256" } ], "name": "mintMemorialNFT", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
            // counter görünüm fonksiyonu
            { "inputs": [], "name": "counter", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "stateMutability": "view", "type": "function" }
        ];

        // Web3 Global Değişkenler
        let provider;
        let signer;
        let contract;
        let walletAddress = null;
        let lastAnalysisResult = null;
        
        // UI Elementleri
        const fnameInput = document.getElementById('fname');
        const analyzeButton = document.getElementById('analyze-button');
        const mintCastButton = document.getElementById('mint-cast-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const resultsSection = document.getElementById('results-section');
        const engagerList = document.getElementById('engager-list');
        const targetFnameSpan = document.getElementById('target-fname');
        const errorMessage = document.getElementById('error-message');
        const connectWalletButton = document.getElementById('connect-wallet-button');
        const walletInfoSpan = document.getElementById('wallet-info');
        const networkInfoSpan = document.getElementById('network-info');
        const counterDisplay = document.getElementById('counter-display');
        const txInfo = document.getElementById('tx-info');

        // Simüle Edilmiş Farcaster Etkileşim Verileri
        const mockEngagers = {
            'dwr': [
                { fname: 'v', fid: 2, engagement_score: 980, casts: 120, followers: '15.2k' },
                { fname: 'ccarella', fid: 3, engagement_score: 750, casts: 80, followers: '10.5k' },
                { fname: 'pedro', fid: 4, engagement_score: 520, casts: 200, followers: '2.1k' },
                { fname: 'greg', fid: 5, engagement_score: 410, casts: 45, followers: '800' },
                { fname: 'alice', fid: 6, engagement_score: 330, casts: 150, followers: '1.3k' },
            ],
            'nodepro': [
                { fname: 'synth_dev', fid: 501, engagement_score: 1100, casts: 300, followers: '50k' },
                { fname: 'web3_wizard', fid: 502, engagement_score: 950, casts: 150, followers: '22k' },
                { fname: 'solidity_max', fid: 503, engagement_score: 820, casts: 80, followers: '15k' },
                { fname: 'chain_explorer', fid: 504, engagement_score: 700, casts: 210, followers: '18k' },
                { fname: 'crypto_analyst', fid: 505, engagement_score: 610, casts: 40, followers: '7k' },
            ],
            'simulasyoncu': [
                { fname: 'mehmet', fid: 101, engagement_score: 650, casts: 50, followers: '300' },
                { fname: 'ayse', fid: 102, engagement_score: 500, casts: 90, followers: '450' },
                { fname: 'deniz', fid: 103, engagement_score: 300, casts: 10, followers: '200' },
                { fname: 'kaan', fid: 104, engagement_score: 250, casts: 30, followers: '150' },
                { fname: 'zeynep', fid: 105, engagement_score: 200, casts: 60, followers: '1000' },
            ]
        };

        // --- Web3 ve Cüzdan Fonksiyonları ---

        // Yardımcı fonksiyon: Adresi kısaltma
        function shortenAddress(address) {
            return address ? address.substring(0, 6) + '...' + address.substring(address.length - 4) : 'Bilinmiyor';
        }

        // 'Base' Ağına Geçişi Zorunlu Kılma Fonksiyonu
        async function switchToBaseNetwork() {
            if (!provider) {
                console.error("Provider başlatılamadı.");
                return false;
            }

            try {
                const network = await provider.getNetwork();
                if (network.chainId === TARGET_CHAIN_ID_DEC) {
                    networkInfoSpan.textContent = TARGET_NETWORK_NAME.toUpperCase();
                    networkInfoSpan.classList.remove('text-red-500');
                    networkInfoSpan.classList.add('text-green-600');
                    return true; // Zaten doğru ağda
                }

                // Doğru ağda değil, UI'ı güncelle
                networkInfoSpan.textContent = 'YANLIŞ AĞ';
                networkInfoSpan.classList.remove('text-green-600');
                networkInfoSpan.classList.add('text-red-500');
                
                txInfo.textContent = `Lütfen MetaMask'i "${TARGET_NETWORK_NAME}" ağına geçirin...`;
                txInfo.classList.remove('hidden');

                // Ağı değiştirmeyi dene
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: TARGET_CHAIN_ID_HEX }],
                });
                
                // Başarılı olursa (veya chainChanged listener tetiklenirse)
                networkInfoSpan.textContent = TARGET_NETWORK_NAME.toUpperCase();
                networkInfoSpan.classList.remove('text-red-500');
                networkInfoSpan.classList.add('text-green-600');
                txInfo.classList.add('hidden');
                return true;

            } catch (switchError) {
                // Hata Kodu 4902: Zincir (Ağ) MetaMask'e eklenmemiş
                if (switchError.code === 4902) {
                    try {
                        txInfo.textContent = `"${TARGET_NETWORK_NAME}" ağı MetaMask'e ekleniyor...`;
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [
                                {
                                    chainId: TARGET_CHAIN_ID_HEX,
                                    chainName: 'Base',
                                    nativeCurrency: {
                                        name: 'Ethereum',
                                        symbol: 'ETH',
                                        decimals: 18,
                                    },
                                    rpcUrls: ['https://mainnet.base.org'],
                                    blockExplorerUrls: ['https://basescan.org'],
                                },
                            ],
                        });
                        // Eklendikten sonra tekrar deneme veya sayfa yenileme (listener halleder)
                        return true;
                    } catch (addError) {
                        console.error("Base ağı eklenemedi:", addError);
                        errorMessage.textContent = '"Base" ağı eklenemedi. Lütfen manuel olarak ekleyin.';
                        errorMessage.classList.remove('hidden');
                        return false;
                    }
                }
                // Diğer hatalar (örn: kullanıcı reddetti)
                console.error("Ağ değiştirme hatası:", switchError);
                errorMessage.textContent = `Lütfen "Base" ağına geçişi onaylayın. (Hata: ${switchError.message})`;
                errorMessage.classList.remove('hidden');
                return false;
            }
        }

        // Cüzdan Bağlantısı
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                errorMessage.textContent = 'MetaMask kurulu değil! Lütfen bir Web3 cüzdanı kurun.';
                errorMessage.classList.remove('hidden');
                return;
            }

            loadingIndicator.classList.remove('hidden');
            txInfo.classList.add('hidden');
            errorMessage.classList.add('hidden');
            
            try {
                // Hesapları iste
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                walletAddress = accounts[0];
                
                // Provider'ı başlat
                provider = new ethers.providers.Web3Provider(window.ethereum);

                // --- AĞ KONTROLÜ VE DEĞİŞTİRME ---
                const networkSwitchSuccess = await switchToBaseNetwork();
                if (!networkSwitchSuccess) {
                    loadingIndicator.classList.add('hidden');
                    // Hata mesajı zaten `switchToBaseNetwork` tarafından ayarlandı.
                    return; 
                }
                // --- AĞ KONTROLÜ BİTTİ ---

                // Signer ve Kontratı ayarla
                signer = provider.getSigner();
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                // UI Güncelleme
                walletInfoSpan.textContent = shortenAddress(walletAddress);
                walletInfoSpan.classList.remove('text-red-500');
                walletInfoSpan.classList.add('text-green-600');
                connectWalletButton.textContent = 'Bağlandı';
                connectWalletButton.disabled = true;
                connectWalletButton.classList.replace('primary-bg', 'bg-green-600');
                
                // Analiz butonunu etkinleştir
                analyzeButton.disabled = false;
                analyzeButton.classList.replace('bg-gray-400', 'primary-bg');
                analyzeButton.classList.replace('cursor-not-allowed', 'cursor-pointer');
                
                // Sayaç değerini çek
                await fetchCounterValue();

            } catch (error) {
                console.error("Cüzdan bağlantı hatası:", error);
                errorMessage.textContent = 'Cüzdan bağlantısı reddedildi veya bir hata oluştu.';
                errorMessage.classList.remove('hidden');
            } finally {
                loadingIndicator.classList.add('hidden');
            }
        }

        // Akıllı Kontrattan Sayaç Değerini Çekme
        async function fetchCounterValue() {
            if (!contract) return;
            try {
                const count = await contract.counter();
                counterDisplay.textContent = `Sayaç Durumu: ${count.toString()}`;
            } catch (error) {
                console.error("Sayaç değeri çekilemedi:", error);
                if (CONTRACT_ADDRESS === "0xSIIN_BASE_MAINNET_KONTRAT_ADRESINIZ") {
                    counterDisplay.textContent = 'Sayaç Durumu: Kontrat adresi ayarlanmamış!';
                } else {
                    counterDisplay.textContent = 'Sayaç Durumu: Kontrat Hatası (Yanlış Adres?)';
                }
            }
        }

        // Analiz Sonrası Sayaç Artırma İşlemi
        async function handleIncrementCounter() {
            txInfo.textContent = 'Sayaç artırma işlemi için MetaMask\'i kontrol edin...';
            txInfo.classList.remove('hidden', 'text-green-600', 'text-red-600');
            txInfo.classList.add('text-red-600');
            
            try {
                const tx = await contract.incrementCounter();
                console.log("Sayaç Artırma TX Hash:", tx.hash);
                txInfo.textContent = `Sayaç Artırma İşlemi Onaylandı. TX: ${shortenAddress(tx.hash)}`;
                txInfo.classList.replace('text-red-600', 'text-green-600');
                
                await tx.wait(); // İşlemin onaylanmasını bekle
                
                txInfo.textContent = `Sayaç Artırma İşlemi Başarılı!`;
                
                // Yeni sayaç değerini çek
                await fetchCounterValue();
                return true; // Başarı

            } catch (error) {
                console.error("Sayaç artırma işlemi başarısız:", error);
                txInfo.textContent = 'Sayaç Artırma Başarısız. İşlem reddedildi veya hata oluştu.';
                txInfo.classList.replace('text-green-600', 'text-red-600');
                return false; // Başarısızlık
            }
        }
        
        // NFT Basım İşlemi
        async function handleMintNFT() {
            const currentCounter = await contract.counter();
            const tokenId = currentCounter.toNumber(); 

            txInfo.textContent = `NFT basımı için (Token ID: ${tokenId}) MetaMask'i kontrol edin...`;
            txInfo.classList.remove('hidden', 'text-green-600', 'text-red-600');
            txInfo.classList.add('text-red-600');
            
            try {
                const tx = await contract.mintMemorialNFT(walletAddress, tokenId);
                console.log("NFT Mint TX Hash:", tx.hash);
                txInfo.textContent = `NFT Basım İşlemi Onaylandı. TX: ${shortenAddress(tx.hash)}`;
                txInfo.classList.replace('text-red-600', 'text-green-600');
                
                await tx.wait(); // İşlemin onaylanmasını bekle
                
                txInfo.textContent = `NFT Basımı Başarılı! Token ID: ${tokenId}`;
                return tokenId; // Cast işlemi için ID'yi döndür
                
            } catch (error) {
                console.error("NFT basım işlemi başarısız:", error);
                txInfo.textContent = 'NFT Basımı Başarısız. İşlem reddedildi veya hata oluştu.';
                txInfo.classList.replace('text-green-600', 'text-red-600');
                throw error; // Hatanın yayılmasına izin ver
            }
        }

        // --- Farcaster API Simülasyonu ---

        const fetchEngagers = async (fname, apiKey) => {
            const normalizedFname = fname.toLowerCase();
            console.log(`[API Simülasyonu] Pinata API Key (${apiKey.substring(0, 4)}...) ile '@${fname}' için analiz başlatılıyor...`);
            
            await new Promise(resolve => setTimeout(resolve, 2000)); // 2 saniye API gecikmesi simülasyonu

            if (normalizedFname === 'hata') {
                throw new Error("Pinata API: Veri çekme veya hesaplama sırasında bir hata oluştu.");
            }
            
            if (mockEngagers[normalizedFname]) {
                return mockEngagers[normalizedFname];
            } else {
                return mockEngagers['simulasyoncu'].map(user => ({
                    ...user,
                    fname: user.fname + ` (target: ${fname})` 
                }));
            }
        };

        // --- UI ve Ana Akış Fonksiyonları ---
        
        async function analyzeEngagers() {
            const fname = fnameInput.value.trim();
            errorMessage.classList.add('hidden');
            txInfo.classList.add('hidden');

            if (CONTRACT_ADDRESS === "0xSIIN_BASE_MAINNET_KONTRAT_ADRESINIZ") {
                errorMessage.textContent = 'Lütfen koddaki "CONTRACT_ADDRESS" değişkenini güncelleyin.';
                errorMessage.classList.remove('hidden');
                return;
            }

            if (!walletAddress || !contract) {
                errorMessage.textContent = 'Lütfen önce cüzdanınızı bağlayın.';
                errorMessage.classList.remove('hidden');
                return;
            }

            if (!fname) {
                errorMessage.textContent = 'Lütfen bir kullanıcı adı girin.';
                errorMessage.classList.remove('hidden');
                return;
            }

            resultsSection.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');
            analyzeButton.disabled = true;
            mintCastButton.disabled = true;

            try {
                // 1. Farcaster API Simülasyonu ile veriyi çek
                const engagers = await fetchEngagers(fname, PINATA_API_KEY);
                
                // 2. Kontrat üzerindeki sayacı artır (Web3 İşlemi)
                const incrementSuccess = await handleIncrementCounter();
                if (!incrementSuccess) {
                    // Sayaç artırma başarısız olduysa, akışı durdur
                    throw new Error("Sayaç artırma işlemi başarısız oldu.");
                }
                
                // 3. Sonuçları göster
                updateUI(engagers, fname);

            } catch (error) {
                console.error("Genel Analiz Akışı Hatası:", error);
                if (!txInfo.classList.contains('text-green-600')) {
                    errorMessage.textContent = `Analiz sırasında hata oluştu: ${error.message}`;
                    errorMessage.classList.remove('hidden');
                }
                resultsSection.classList.add('hidden');
                
            } finally {
                loadingIndicator.classList.add('hidden');
                analyzeButton.disabled = false;
                mintCastButton.disabled = false; 
            }
        }

        function updateUI(engagers, targetFname) {
            engagerList.innerHTML = '';
            targetFnameSpan.textContent = targetFname;
            lastAnalysisResult = engagers; 
            
            engagers.forEach((user, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'flex items-center space-x-4 p-4 bg-gray-50 rounded-xl shadow-sm hover:shadow-md transition duration-200';
                
                listItem.innerHTML = `
                    <div class="flex items-center justify-center w-8 h-8 rounded-full primary-bg text-white font-bold text-lg">${index + 1}</div>
                    
                    <div class="flex-grow">
                        <p class="text-lg font-semibold primary-text">@${user.fname}</p>
                        <p class="text-xs text-gray-500">FID: ${user.fid}</p>
                    </div>

                    <div class="text-right">
                        <p class="text-sm font-bold text-gray-800">Puan: ${user.engagement_score}</p>
                        <p class="text-xs text-gray-500">Yayın: ${user.casts} | Takipçi: ${user.followers}</p>
                    </div>
                `;
                engagerList.appendChild(listItem);
            });
            
            resultsSection.classList.remove('hidden');
        }

        // NFT Basma ve Farcaster'a Yayınlama Fonksiyonu
        async function mintAndCast() {
            if (!walletAddress || !lastAnalysisResult || !contract) {
                txInfo.textContent = "Lütfen önce cüzdanınızı bağlayın ve analizi çalıştırın.";
                txInfo.classList.remove('hidden', 'text-green-600');
                txInfo.classList.add('text-red-600');
                return;
            }
            
            loadingIndicator.classList.remove('hidden');
            mintCastButton.disabled = true;

            try {
                // 1. NFT Basım İşlemini Başlat (Web3 İşlemi)
                const nftId = await handleMintNFT(); // Token ID'sini alır
                
                // 2. Farcaster Cast Oluşturma
                const targetFname = targetFnameSpan.textContent;
                const topEngagerNames = lastAnalysisResult.slice(0, 3).map(u => `@${u.fname}`).join(', ');
                
                const castText = `✅ NFT Basıldı! @${targetFname}'in Top 3 Etkileşimcisi: ${topEngagerNames}. Komemoratif NFT (ID: ${nftId}) cüzdanıma basıldı! Zincir üstü işlem başarıyla tamamlandı. #farcaster #web3 #nft`;

                const warpcastUrl = `https://warpcast.com/~/compose?text=${encodeURIComponent(castText)}`;
                
                // Yeni sekmede aç
                window.open(warpcastUrl, '_blank');
                
            } catch (error) {
                console.error("Mint ve Cast Akışı Hatası:", error);
            } finally {
                loadingIndicator.classList.add('hidden');
                mintCastButton.disabled = false;
            }
        }

        // Sayfa yüklendiğinde Web3 Event Listener'larını ayarla
        document.addEventListener('DOMContentLoaded', () => {
            analyzeButton.disabled = true;
            if (typeof window.ethereum !== 'undefined') {
                // Ağ veya hesap değiştiğinde yeniden yükle (ağ değişimini doğru yönetmek için)
                window.ethereum.on('accountsChanged', (accounts) => {
                    window.location.reload(); 
                });
                window.ethereum.on('chainChanged', (chainId) => {
                    if (chainId !== TARGET_CHAIN_ID_HEX) {
                        networkInfoSpan.textContent = 'YANLIŞ AĞ';
                        networkInfoSpan.classList.remove('text-green-600');
                        networkInfoSpan.classList.add('text-red-500');
                    }
                    window.location.reload();
                });
            } else {
                networkInfoSpan.textContent = "MetaMask Yok";
                networkInfoSpan.classList.add('text-red-500');
            }
        });
    </script>

</body>
</html>
